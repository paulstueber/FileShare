version: '2'
services:
    mongo:
        image: mongo:latest
        ports:
            - "27017:27017"

    zookeeper:
        image: dockerkafka/zookeeper
        ports:
            - "2181:2181"

    kafka:
        image: dockerkafka/kafka
        ports:
            - "9092:9092"
        links:
            - zookeeper

    kafka-manager:
        image: dockerkafka/kafka-manager
        environment:
            - ZK_HOSTS=zookeeper:2181
        ports:
            - "9000:9000"
        links:
            - zookeeper
            - kafka

    registry:
        build: ./registry
        ports:
            - "8761:8761"

    media:
        build: ./media
        environment:
            - SPRING_DATA_MONGODB_URI=mongodb://mongo:27017
            - SPRING_DATA_MONGODB_HOST=mongo
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://registry:8761/eureka/
        ports:
            - "8081:8081"
        volumes:
            - /tmp/media:/tmp/media
        depends_on:
              - "mongo"
              - "registry"
        links:
            - mongo
            - registry:registry

    ui:
        build: ./ui
        environment:
            - SPRING_DATA_MONGODB_URI=mongodb://mongo:27017
            - SPRING_DATA_MONGODB_HOST=mongo
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://registry:8761/eureka/
            - CONFIG_INIT_USER_NAME=admin@localhost
            - CONFIG_INIT_USER_PASSWORD=admin
        ports:
            - "8080:8080"
        depends_on:
              - "mongo"
              - "registry"
        links:
            - media
            - mongo
            - registry:registry
